<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Minigry - Flappy Bird</title>
  <style>
    body {
      margin: 0;
      text-align: center;
      font-family: Arial, sans-serif;
      background-color: #0e0914;
      overflow: hidden;
    }

    h1 {
      margin-top: 20px;
      color: #ffffff;
      text-shadow: 2px 2px #000;
    }

    canvas {
      background-color: #70c5ce;
      border: 3px solid #333;
      margin: 10px auto;
      display: block;
      width: 100%;
      height: auto;
      max-width: 550px;
    }

    #Zaciemnienie {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 9;
    }

    #OknaPrzeg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(20, 20, 20, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
      animation: fadeIn 0.3s ease forwards;
    }

    #Kontener {
      background: linear-gradient(to bottom right, #ffffff, #e8f1f2);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.4s ease forwards;
      min-width: 300px;
    }

    #Kontener h2 {
      margin-top: 0;
      color: #333;
      font-size: 2em;
    }

    #Kontener p {
      font-size: 1.4em;
      margin: 10px 0 20px;
    }

    #Kontener button {
      background-color: #00a87d;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    #Kontener button:hover {
      background-color: #00936c;
      transform: scale(1.05);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>Flappy Bird</h1>
  <canvas id="Plansza" width="500" height="650"></canvas>
  <div id="Zaciemnienie"></div>

  <div id="OknaPrzeg">
    <div id="Kontener">
      <h2>Koniec gry!</h2>
      <p>Twój wynik: <span id="wynik"></span></p>
      <button onclick="startGry()">Zagraj ponownie</button>
    </div>
  </div>

  <script>
    const plansza = document.getElementById("Plansza");
    const kontekst = plansza.getContext("2d");

    const PROMIEN_PTAKA = 25;
    const SZEROKOSC_PRZESZKODY = 60;
    const ODSTEP = 160;
    const PREDKOSC_PRZESZKODY = 3.8;
    const GRAWITACJA = 0.25;

    let ptak = { x: 50, y: plansza.height / 2, predkosc: 0 };
    let przeszkody = [];
    let wynik = 0;
    let graAktywna = false;
    let graRozpoczeta = false;
    let idAnimacji = null;

    const obrazPtaka = new Image();
    obrazPtaka.src = "bird.png";

    const ruraGlowka = new Image();
    ruraGlowka.src = "pipeUp.png";

    const ruraCialo = new Image();
    ruraCialo.src = "pipeDown.png";

    const tloObraz = new Image();
    tloObraz.src = "FlappyBg.gif";

    function dodajPrzeszkode() {
      przeszkody.push({
        x: plansza.width,
        wysokosc: Math.random() * (plansza.height - ODSTEP - 100) + 50,
      });
    }

    function rysujStartowyEkran() {
      kontekst.drawImage(tloObraz, 0, 0, plansza.width, plansza.height);
      kontekst.fillStyle = "rgba(0, 0, 0, 0.6)";
      kontekst.fillRect(0, 0, plansza.width, plansza.height);

      kontekst.fillStyle = "#ffffff";
      kontekst.font = "30px Cabin";
      kontekst.textAlign = "center";
      kontekst.fillText("Kliknij lub naciśnij spację,", plansza.width / 2, plansza.height / 2 - 20);
      kontekst.fillText("aby rozpocząć grę", plansza.width / 2, plansza.height / 2 + 20);
    }

    function Rozpoczniigre() {
      if (!graRozpoczeta) {
        graRozpoczeta = true;
        startGry();
      } else if (graAktywna) {
        ptak.predkosc = -6;
      }
    }

    document.addEventListener("keydown", e => {
      if (e.code === "Space") Rozpoczniigre();
    });

    document.addEventListener("click", Rozpoczniigre);

    function rysujRure(x, y, odwrocona) {
      const wysokoscGlowy = 30;
      const szerokoscGlowy = SZEROKOSC_PRZESZKODY + 15;
      const wysokoscCiala = odwrocona ? y - wysokoscGlowy : plansza.height - y - wysokoscGlowy;
      if (wysokoscCiala <= 0) return;

      if (odwrocona) {
        kontekst.save();
        kontekst.translate(x + SZEROKOSC_PRZESZKODY / 2, y);
        kontekst.rotate(Math.PI);
        kontekst.drawImage(ruraGlowka, -szerokoscGlowy / 2, 0, szerokoscGlowy, wysokoscGlowy);
        kontekst.drawImage(ruraCialo, -SZEROKOSC_PRZESZKODY / 2, wysokoscGlowy, SZEROKOSC_PRZESZKODY, wysokoscCiala);
        kontekst.restore();
      } else {
        kontekst.drawImage(ruraCialo, x, y + wysokoscGlowy, SZEROKOSC_PRZESZKODY, wysokoscCiala);
        kontekst.drawImage(ruraGlowka, x - 7.5, y, szerokoscGlowy, wysokoscGlowy);
      }
    }

    function sprawdzKolizje(przeszkoda) {
      const rozszerzenieGlowy = 7.5;
      const kolizjaGora = ptak.x + PROMIEN_PTAKA > przeszkoda.x - rozszerzenieGlowy &&
                         ptak.x - PROMIEN_PTAKA < przeszkoda.x + SZEROKOSC_PRZESZKODY + rozszerzenieGlowy &&
                         ptak.y - PROMIEN_PTAKA < przeszkoda.wysokosc;

      const kolizjaDol = ptak.x + PROMIEN_PTAKA > przeszkoda.x - rozszerzenieGlowy &&
                        ptak.x - PROMIEN_PTAKA < przeszkoda.x + SZEROKOSC_PRZESZKODY + rozszerzenieGlowy &&
                        ptak.y + PROMIEN_PTAKA > przeszkoda.wysokosc + ODSTEP;

      return kolizjaGora || kolizjaDol;
    }

    function aktualizujGre() {
      kontekst.clearRect(0, 0, plansza.width, plansza.height);
      kontekst.drawImage(tloObraz, 0, 0, plansza.width, plansza.height);

      przeszkody.forEach((prz, i) => {
        rysujRure(prz.x, prz.wysokosc, true);
        rysujRure(prz.x, prz.wysokosc + ODSTEP, false);

        if (graAktywna) prz.x -= PREDKOSC_PRZESZKODY;

        if (sprawdzKolizje(prz)) return Zresetuj();

        if (prz.x + SZEROKOSC_PRZESZKODY < 0) {
          przeszkody.splice(i, 1);
          wynik++;
        }
      });

      if (przeszkody.length === 0 || przeszkody[przeszkody.length - 1].x < plansza.width - 350) {
        dodajPrzeszkode();
      }

      kontekst.drawImage(obrazPtaka, ptak.x - PROMIEN_PTAKA, ptak.y - PROMIEN_PTAKA, PROMIEN_PTAKA * 2, PROMIEN_PTAKA * 2);

      kontekst.font = "40px Arial";
      kontekst.lineWidth = 3;
      kontekst.strokeStyle = "Black";
      const text = wynik.toString();
      const textWidth = kontekst.measureText(text).width;
      const textX = (plansza.width - textWidth) / 2;
      kontekst.strokeText(text, textX, 60);
      kontekst.fillStyle = "#276864";
      kontekst.fillText(text, textX, 60);

      ptak.predkosc += GRAWITACJA;
      ptak.y += ptak.predkosc;

      if (ptak.y + PROMIEN_PTAKA > plansza.height || ptak.y - PROMIEN_PTAKA < 0) {
        Zresetuj();
        return;
      }

      idAnimacji = requestAnimationFrame(aktualizujGre);
    }

    function Zresetuj() {
      if (!graAktywna) return;
      graAktywna = false;
      const zaciemnienie = document.getElementById("Zaciemnienie");
      zaciemnienie.style.opacity = 1;

      setTimeout(() => {
        document.getElementById("wynik").textContent = wynik;
        document.getElementById("OknaPrzeg").style.display = "flex";
        zaciemnienie.style.opacity = 0;
      }, 300);
    }

    function startGry() {
      cancelAnimationFrame(idAnimacji);
      document.getElementById("OknaPrzeg").style.display = "none";
      ptak = { x: 50, y: plansza.height / 2, predkosc: 0 };
      przeszkody = [];
      wynik = 0;
      graAktywna = true;
      dodajPrzeszkode();
      aktualizujGre();
    }

    tloObraz.onload = () => {
      rysujStartowyEkran();
    };
  </script>
</body>
</html>
